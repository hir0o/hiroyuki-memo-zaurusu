

# awkコマンド

オークと読む。プログラミング言語の一種。

「grepにプログラム機能をつけたもの」と理解すると、素直に使える

### 偶数を表示

grepだとこう

```
$ seq 5 | grep '[24]'
2
4
```

awkだとこう

```
$ seq 5 | awk '/[24]/'
2
4
```

$1で、入力を受け取れる。$2、$3で2列目、3列目の値を使える

```
$ seq 5 | awk '$1 % 2 == 0'
2
4
```

マッチした行に処理を加えることもできる

printfはc言語っぽくフォーマットできる

```
$ seq 5 | awk '$1 % 2 == 0 { printf("%d 偶数\n", $1) }'
2 偶数
4 偶数
```

以下のように2組以上の条件を書くこともできる.

```
$ seq 5 | awk '$1 % 2 == 0 { printf("%d 偶数\n", $1) } $1 % 2 { printf("%d 奇数\n", $1) } '
1 奇数
2 偶数
3 奇数
4 偶数
5 奇数
```

### BEGINパターン、ENDパターン

以下のように、変数を定義したりできる

BEGIN,ENDはそれぞれ,BEGINパターン、ENDパターンと呼ばれる.
`BEGIN {a=0}` は、1行目の処理を始める前に実行される。
`'END{printf("合計 %d\n", a)}'` は、最後の行の処理が終わった後に呼ばれる。
また、`{a+=1}`は全ての行で実行される。

```
$ seq 5 | awk 'BEGIN {a=0}$1 % 2 == 0 { printf("%d 偶数\n", $1) } $1 % 2 { printf("%d 奇数\n", $1) }{a+=1}END{printf("合計 %d\n", a)} '
```

### awkで使える変数

| 変数        | 意味                |
| ----------- | ------------------- |
| $0          | 行全体              |
| $n ($1とか) | n個目の文字         |
| $NF         | 最後の文字          |
| $(NF-n)     | 最後からn個目の文字 |

### 区切り文字を変える

-Fオプションで、区切り文字をスペースやタブから変更できる.
以下の例だと、区切り文字を`:`に変えている

```
$ cat access.log| awk -F : '{print $(NF-2)}'
```
